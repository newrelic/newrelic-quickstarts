{
  "name": "Databricks Pipeline Updates",
  "description": "Monitor the status and performance of your Databricks pipeline updates, including update and flow durations and flow data quality metrics.",
  "pages": [
    {
      "name": "Pipeline Updates",
      "description": null,
      "widgets": [
        {
          "title": "Pipelines running",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 4,
            "height": 2
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM DatabricksPipelineSummary \nSELECT latest(runningPipelineCount) AS 'Pipelines'\nWHERE databricksWorkspaceName = {{workspace}}"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Pipelines failed",
          "layout": {
            "column": 5,
            "row": 1,
            "width": 4,
            "height": 2
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM DatabricksPipelineSummary \nSELECT latest(failedPipelineCount) AS 'Pipelines'\nWHERE databricksWorkspaceName = {{workspace}}"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Pipelines idle",
          "layout": {
            "column": 9,
            "row": 1,
            "width": 4,
            "height": 2
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM DatabricksPipelineSummary \nSELECT latest(idlePipelineCount) AS 'Pipelines'\nWHERE databricksWorkspaceName = {{workspace}}"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Updates running",
          "layout": {
            "column": 1,
            "row": 3,
            "width": 2,
            "height": 2
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM DatabricksPipelineSummary \nSELECT latest(runningUpdateCount) AS 'Updates'\nWHERE databricksWorkspaceName = {{workspace}}"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Updates waiting for resources",
          "layout": {
            "column": 3,
            "row": 3,
            "width": 2,
            "height": 2
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM DatabricksPipelineSummary \nSELECT latest(waitingForResourcesUpdateCount) AS 'Updates'\nWHERE databricksWorkspaceName = {{workspace}}"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Updates setting up tables",
          "layout": {
            "column": 5,
            "row": 3,
            "width": 2,
            "height": 2
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM DatabricksPipelineSummary \nSELECT latest(settingUpTablesUpdateCount) AS 'Updates'\nWHERE databricksWorkspaceName = {{workspace}}"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Updates completed",
          "layout": {
            "column": 7,
            "row": 3,
            "width": 2,
            "height": 2
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM DatabricksPipelineUpdate\nSELECT count(*) AS 'Updates'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete' AND status = 'COMPLETED'\nLIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Updates failed",
          "layout": {
            "column": 9,
            "row": 3,
            "width": 2,
            "height": 2
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM DatabricksPipelineUpdate\nSELECT count(*) AS 'Updates'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete' AND status = 'FAILED'\nLIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Updates canceled",
          "layout": {
            "column": 11,
            "row": 3,
            "width": 2,
            "height": 2
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM DatabricksPipelineUpdate\nSELECT count(*) AS 'Updates'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete' AND status = 'CANCELED'\nLIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Update count by workspace",
          "layout": {
            "column": 1,
            "row": 5,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineUpdate\nSELECT filter(count(*), WHERE event = 'start') AS 'Updates started', filter(count(*), WHERE event = 'complete') AS 'Updates complete'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}}\nFACET workspace \nTIMESERIES\nLIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average update duration by workspace",
          "layout": {
            "column": 7,
            "row": 5,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineUpdate\nSELECT average(duration) / 1000 AS 'Update duration'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete' \nFACET workspace\nTIMESERIES\nLIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Running updates",
          "layout": {
            "column": 1,
            "row": 8,
            "width": 12,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace,\n concat(databricksWorkspaceUrl, '/pipelines/', databricksPipelineId, '/updates/', databricksPipelineUpdateId) AS databricksPipelineUpdateUrl\nSELECT count(*)\nFROM (\n FROM DatabricksPipelineUpdate\n SELECT\n  uniqueCount(event) as 'total',\n  latest(event) as 'state'\n FACET databricksWorkspaceName, databricksWorkspaceUrl, databricksPipelineId, pipelineName, databricksPipelineUpdateId, toDatetime(creationTime, 'MMMM dd, YYYY HH:mm:ss') AS creationTime\n ORDER BY max(timestamp)\n LIMIT 100)\nWHERE total = 1 AND state = 'start'\nFACET workspace AS Workspace, pipelineName AS Pipeline, substring(databricksPipelineUpdateId, 0, 6) as Update, creationTime AS 'Update Creation Time', databricksPipelineUpdateUrl AS 'Databricks Link'\nLIMIT 100"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Recent updates",
          "layout": {
            "column": 1,
            "row": 11,
            "width": 12,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "dataFormatters": [
              {
                "name": "Duration",
                "type": "humanized"
              }
            ],
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace,\n substring(databricksPipelineUpdateId, 0, 6) AS update,\n concat(databricksWorkspaceUrl, '/pipelines/', databricksPipelineId, '/updates/', databricksPipelineUpdateId) AS databricksPipelineUpdateUrl\nFROM DatabricksPipelineUpdate\nSELECT workspace,\n databricksClusterName AS Cluster,\n pipelineName AS Pipeline,\n update,\n creationTime,\n completionTime,\n status,\n duration / 1000 AS Duration,\n databricksPipelineUpdateUrl AS 'Databricks Link'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nLIMIT 100"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Average update duration by workspace and pipeline",
          "layout": {
            "column": 1,
            "row": 14,
            "width": 4,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineUpdate \nSELECT average(duration) / 1000 AS 'seconds'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "SECONDS"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average update wait duration by workspace and pipeline",
          "layout": {
            "column": 5,
            "row": 14,
            "width": 4,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineUpdate\nSELECT average(waitDuration) / 1000 AS 'seconds'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "SECONDS"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average update run duration by workspace and pipeline",
          "layout": {
            "column": 9,
            "row": 14,
            "width": 4,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineUpdate \nSELECT average(runDuration) / 1000 AS 'seconds'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "SECONDS"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Running flows",
          "layout": {
            "column": 1,
            "row": 17,
            "width": 12,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace,\n  concat(databricksWorkspaceUrl, '/pipelines/', databricksPipelineId, '/updates/', databricksPipelineUpdateId) AS databricksPipelineUpdateUrl\nSELECT count(*)\nFROM (\n FROM DatabricksPipelineFlow\n SELECT\n  uniqueCount(event) as 'total',\n  latest(event) as 'state'\n FACET databricksWorkspaceName, databricksWorkspaceUrl, databricksPipelineId, pipelineName, databricksPipelineUpdateId, databricksPipelineFlowName, toDatetime(queueStartTime, 'MMMM dd, YYYY HH:mm:ss') AS queueStartTime\n ORDER BY max(timestamp)\n LIMIT 100)\nWHERE total = 1 AND state = 'start'\nFACET workspace AS Workspace, pipelineName AS Pipeline, substring(databricksPipelineUpdateId, 0, 6) as Update, databricksPipelineFlowName AS Flow, queueStartTime AS 'Queue Start Time', databricksPipelineUpdateUrl AS 'Databricks Link'\nLIMIT 100 "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Recent flows",
          "layout": {
            "column": 1,
            "row": 20,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "dataFormatters": [
              {
                "name": "Duration",
                "type": "humanized"
              }
            ],
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace,\n substring(databricksPipelineUpdateId, 0, 6) AS update,\n concat(databricksWorkspaceUrl, '/pipelines/', databricksPipelineId, '/updates/', databricksPipelineUpdateId) AS databricksPipelineUpdateUrl\nFROM DatabricksPipelineFlow\nSELECT workspace,\n databricksClusterName AS Cluster,\n pipelineName AS Pipeline,\n update,\n databricksPipelineFlowName AS Flow,\n queueStartTime,\n completionTime,\n status,\n duration / 1000 AS Duration,\n databricksPipelineUpdateUrl AS 'Databricks Link'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nLIMIT 100"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Average flow duration by workspace, pipeline, and flow",
          "layout": {
            "column": 1,
            "row": 24,
            "width": 4,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineFlow \nSELECT average(duration) / 1000 AS 'seconds'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName, databricksPipelineFlowName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "SECONDS"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average flow queue duration by workspace, pipeline, and flow",
          "layout": {
            "column": 5,
            "row": 24,
            "width": 4,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineFlow \nSELECT average(queueDuration) / 1000 AS 'seconds'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName, databricksPipelineFlowName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "SECONDS"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average flow plan duration by workspace, pipeline, and flow",
          "layout": {
            "column": 9,
            "row": 24,
            "width": 4,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineFlow\nSELECT average(planDuration) / 1000 AS 'seconds'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName, databricksPipelineFlowName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "SECONDS"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average rows written by workspace, pipeline, and flow",
          "layout": {
            "column": 1,
            "row": 27,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.bar"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineFlow\nSELECT average(outputRowCount)\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName, databricksPipelineFlowName"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Average records dropped by workspace, pipeline, and flow",
          "layout": {
            "column": 7,
            "row": 27,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.bar"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineFlow\nSELECT average(droppedRecordCount)\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName, databricksPipelineFlowName"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Average backlog bytes by workspace, pipeline, and flow",
          "layout": {
            "column": 1,
            "row": 30,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.bar"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineFlow\nSELECT average(backlogBytes)\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName, databricksPipelineFlowName"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Average backlog files by workspace, pipeline, and flow",
          "layout": {
            "column": 7,
            "row": 30,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.bar"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace\nFROM DatabricksPipelineFlow\nSELECT average(backlogFileCount)\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete'\nFACET workspace, pipelineName, databricksPipelineFlowName"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Expectation records passed",
          "layout": {
            "column": 1,
            "row": 33,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "dataFormatters": [
              {
                "name": "Records",
                "type": "humanized"
              }
            ],
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace,\n substring(databricksPipelineUpdateId, 0, 6) AS update\nFROM DatabricksPipelineFlowExpectation\nSELECT workspace, databricksClusterName AS cluster, pipelineName AS Pipeline, update, databricksPipelineFlowName AS Flow, name AS Expectation, dataset, passedRecordCount AS Records\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND failedRecordCount = 0\nLIMIT MAX\n "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Expectation records failed",
          "layout": {
            "column": 1,
            "row": 37,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "dataFormatters": [
              {
                "name": "Records",
                "type": "humanized"
              }
            ],
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace,\n substring(databricksPipelineUpdateId, 0, 6) AS update\nFROM DatabricksPipelineFlowExpectation\nSELECT workspace, databricksClusterName AS Cluster, pipelineName AS Pipeline, update, databricksPipelineFlowName AS Flow, name AS Expectation, dataset, failedRecordCount AS Records\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND failedRecordCount > 0\nLIMIT MAX\n "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        }
      ]
    },
    {
      "name": "Spark Metrics",
      "description": null,
      "widgets": [
        {
          "title": "Spark jobs by pipeline update",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "dataFormatters": [
              {
                "name": "Spark Job ID",
                "precision": 0,
                "type": "humanized"
              },
              {
                "name": "Duration",
                "precision": 2,
                "type": "humanized"
              }
            ],
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace,\n substring(databricksPipelineUpdateId, 0, 6) as update,\n concat(databricksWorkspaceUrl, '/pipelines/', databricksPipelineId, '/updates/', databricksPipelineUpdateId) AS databricksPipelineUpdateUrl\nFROM SparkJob\nSELECT\n workspace,\n databricksClusterName AS Cluster,\n sparkAppName AS 'Spark App Name',\n description AS 'Job Description',\n jobId AS 'Spark Job ID',\n duration / 1000 AS Duration,\n databricksPipelineId AS 'Pipeline ID',\n update as 'Update',\n databricksPipelineUpdateUrl AS 'Databricks Link'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete' AND databricksPipelineId IS NOT NULL AND databricksPipelineUpdateId IS NOT NULL\nLIMIT MAX "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Spark stages by pipeline update",
          "layout": {
            "column": 1,
            "row": 5,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "dataFormatters": [
              {
                "name": "Duration",
                "precision": 2,
                "type": "humanized"
              },
              {
                "name": "Spark Job",
                "precision": 0,
                "type": "humanized"
              }
            ],
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace,\n substring(databricksPipelineUpdateId, 0, 6) as update,\n concat(databricksWorkspaceUrl, '/pipelines/', databricksPipelineId, '/updates/', databricksPipelineUpdateId) AS databricksPipelineUpdateUrl\nFROM SparkStage\nSELECT\n workspace,\n databricksClusterName AS Cluster,\n sparkAppName AS 'Spark App Name',\n jobDescription,\n stageId AS 'Spark Stage ID',\n duration / 1000 AS Duration,\n databricksPipelineId AS 'Pipeline ID',\n update as 'Update',\n databricksPipelineUpdateUrl AS 'Databricks Link'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete' AND databricksPipelineId IS NOT NULL AND databricksPipelineUpdateId IS NOT NULL\nLIMIT MAX "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Spark tasks by pipeline update",
          "layout": {
            "column": 1,
            "row": 9,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "dataFormatters": [
              {
                "name": "Duration",
                "precision": 2,
                "type": "humanized"
              },
              {
                "name": "Spark Job",
                "precision": 0,
                "type": "humanized"
              }
            ],
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH\n substring(databricksWorkspaceName, 0, position(databricksWorkspaceName, '.')) AS workspace,\n substring(databricksPipelineUpdateId, 0, 6) as update,\n concat(databricksWorkspaceUrl, '/pipelines/', databricksPipelineId, '/updates/', databricksPipelineUpdateId) AS databricksPipelineUpdateUrl\nFROM SparkTask\nSELECT\n workspace,\n databricksClusterName AS Cluster,\n sparkAppName AS 'Spark App Name',\n jobDescription,\n taskId AS 'Spark Task ID',\n duration / 1000 AS Duration,\n databricksPipelineId AS 'Pipeline ID',\n update as 'Update',\n databricksPipelineUpdateUrl AS 'Databricks Link'\nWHERE databricksWorkspaceName = {{workspace}} AND databricksClusterName = {{cluster}} AND event = 'complete' AND databricksPipelineId IS NOT NULL AND databricksPipelineUpdateId IS NOT NULL\nLIMIT MAX "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        }
      ]
    }
  ],
  "variables": [
    {
      "name": "workspace",
      "items": null,
      "defaultValues": [],
      "nrqlQuery": {
        "accountIds": [],
        "query": "FROM DatabricksPipelineSummary\nSELECT uniques(databricksWorkspaceName)"
      },
      "options": {
        "ignoreTimeRange": true,
        "excluded": true
      },
      "title": "Workspace",
      "type": "NRQL",
      "isMultiSelection": false,
      "replacementStrategy": "STRING"
    },
    {
      "name": "cluster",
      "items": null,
      "defaultValues": [],
      "nrqlQuery": {
        "accountIds": [],
        "query": "FROM DatabricksPipelineUpdate SELECT uniques(databricksClusterName)"
      },
      "options": {
        "ignoreTimeRange": true,
        "excluded": true
      },
      "title": "Cluster",
      "type": "NRQL",
      "isMultiSelection": false,
      "replacementStrategy": "STRING"
    }
  ]
}
