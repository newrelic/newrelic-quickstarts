{
  "name": "Databricks Cluster Health",
  "description": "View key health metrics for your Databricks clusters, including CPU, memory, disk, and network usage for both driver and worker nodes.",
  "pages": [
    {
      "name": "Driver Node Metrics",
      "description": null,
      "widgets": [
        {
          "title": "Average CPU %",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM SystemSample\nSELECT average(cpuPercent)\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "max": 100,
              "min": 0,
              "zero": false
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "5 minute load average",
          "layout": {
            "column": 7,
            "row": 1,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM SystemSample\nSELECT latest(loadAverageFiveMinute)\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average memory free",
          "layout": {
            "column": 1,
            "row": 4,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM SystemSample\nSELECT average(memoryFreeBytes)\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average used memory %",
          "layout": {
            "column": 7,
            "row": 4,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM SystemSample\nSELECT average(memoryUsedPercent)\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "max": 100,
              "min": 0,
              "zero": false
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average disk free",
          "layout": {
            "column": 1,
            "row": 7,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM StorageSample\nSELECT average(diskFreeBytes) AS 'Byte'\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName, mountPoint"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Average disk free %",
          "layout": {
            "column": 7,
            "row": 7,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM StorageSample\nSELECT average(diskFreePercent)\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName, mountPoint\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "max": 100,
              "min": 0,
              "zero": false
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average bytes/s received",
          "layout": {
            "column": 1,
            "row": 10,
            "width": 3,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM NetworkSample\nSELECT average(receiveBytesPerSecond)\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES_PER_SECOND"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average bytes/s transmitted",
          "layout": {
            "column": 4,
            "row": 10,
            "width": 3,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM NetworkSample\nSELECT average(transmitBytesPerSecond)\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES_PER_SECOND"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average receive errors/s",
          "layout": {
            "column": 7,
            "row": 10,
            "width": 3,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM NetworkSample\nSELECT average(receiveErrorsPerSecond)\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES_PER_SECOND"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average transmit errors/s",
          "layout": {
            "column": 10,
            "row": 10,
            "width": 3,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM NetworkSample\nSELECT average(transmitErrorsPerSecond)\nWHERE databricksIsDriverNode = 'true'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{driverEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES_PER_SECOND"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        }
      ]
    },
    {
      "name": "Driver Logs",
      "description": null,
      "widgets": [
        {
          "title": "Stdout",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "logger.log-table-widget"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH position(databricksWorkspaceHost, '.') AS firstDot\nFROM Log\nSELECT substring(databricksWorkspaceHost, 0, firstDot) AS 'Workspace', databricksClusterName AS 'Cluster', hostname AS Hostname, message AS Message\nWHERE databricksClusterId IS NOT NULL\n AND databricksLogType = 'driver-stdout'\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND hostname IN ({{driverEntityName}})\nLIMIT 1000"
              }
            ]
          }
        },
        {
          "title": "Stderr",
          "layout": {
            "column": 1,
            "row": 5,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "logger.log-table-widget"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH position(databricksWorkspaceHost, '.') AS firstDot\nFROM Log\nSELECT substring(databricksWorkspaceHost, 0, firstDot) AS 'Workspace', databricksClusterName AS 'Cluster', hostname AS Hostname, message AS Message\nWHERE databricksClusterId IS NOT NULL\n AND databricksLogType = 'driver-stderr'\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND hostname IN ({{driverEntityName}})\nLIMIT 1000"
              }
            ]
          }
        },
        {
          "title": "Log4j",
          "layout": {
            "column": 1,
            "row": 9,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "logger.log-table-widget"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH position(databricksWorkspaceHost, '.') AS firstDot\nFROM Log\nSELECT substring(databricksWorkspaceHost, 0, firstDot) AS 'Workspace', databricksClusterName AS 'Cluster', hostname AS Hostname, level AS Level, message AS Message\nWHERE databricksClusterId IS NOT NULL\n AND databricksLogType = 'driver-log4j'\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND hostname IN ({{driverEntityName}})\nLIMIT 1000"
              }
            ]
          }
        },
        {
          "title": "Event Log",
          "layout": {
            "column": 1,
            "row": 13,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "logger.log-table-widget"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH position(databricksWorkspaceHost, '.') AS firstDot,\n capture(filePath, r'/databricks/driver/eventlogs/(?P<sparkContextId>[^/]+)/.*') AS sparkContextId\nFROM Log\nSELECT substring(databricksWorkspaceHost, 0, firstDot) AS 'Workspace', databricksClusterName AS 'Cluster', sparkContextId AS 'Spark Context ID', Event, `App Name`, `Job ID`, `Stage Info.Stage ID` AS 'Stage ID', `Task Info.Task ID` AS 'Task ID'\nWHERE databricksClusterId IS NOT NULL\n AND databricksLogType = 'spark-eventlog'\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND hostname IN ({{driverEntityName}})\nLIMIT 1000"
              }
            ]
          }
        },
        {
          "title": "Infrastructure Agent Logs",
          "layout": {
            "column": 1,
            "row": 17,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "logger.log-table-widget"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH position(databricksWorkspaceHost, '.') AS firstDot\nFROM Log\nSELECT substring(databricksWorkspaceHost, 0, firstDot) AS 'Workspace', databricksClusterName AS 'Cluster', hostname AS Hostname, MESSAGE.context.component AS Component, MESSAGE.msg AS Message\nWHERE SYSLOG_IDENTIFIER = 'newrelic-infra-service'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND hostname IN ({{driverEntityName}})\nLIMIT 1000"
              }
            ]
          }
        },
        {
          "title": "Databricks Integration Logs (APM)",
          "layout": {
            "column": 1,
            "row": 21,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "logger.log-table-widget"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM Log\nSELECT hostname AS Hostname, level AS Level, message AS Message\nWHERE `newrelic.source` = 'logs.APM'\n AND `entity.name` = 'New Relic Databricks Integration'\n AND hostname IN ({{driverEntityName}})\nLIMIT 1000"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "Worker Node Metrics",
      "description": null,
      "widgets": [
        {
          "title": "Average CPU %",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM SystemSample\nSELECT average(cpuPercent)\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "max": 100,
              "min": 0,
              "zero": false
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "5 minute load average",
          "layout": {
            "column": 7,
            "row": 1,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM SystemSample\nSELECT latest(loadAverageFiveMinute)\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average memory free",
          "layout": {
            "column": 1,
            "row": 4,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM SystemSample\nSELECT average(memoryFreeBytes)\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average used memory %",
          "layout": {
            "column": 7,
            "row": 4,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM SystemSample\nSELECT average(memoryUsedPercent)\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "max": 100,
              "min": 0,
              "zero": false
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average disk free",
          "layout": {
            "column": 1,
            "row": 7,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM StorageSample\nSELECT average(diskFreeBytes) AS 'Byte'\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName, mountPoint"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Average disk free %",
          "layout": {
            "column": 7,
            "row": 7,
            "width": 6,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM StorageSample\nSELECT average(diskFreePercent)\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName, mountPoint\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "yAxisLeft": {
              "max": 100,
              "min": 0,
              "zero": false
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average bytes/s received",
          "layout": {
            "column": 1,
            "row": 10,
            "width": 3,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM NetworkSample\nSELECT average(receiveBytesPerSecond)\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES_PER_SECOND"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average bytes/s transmitted",
          "layout": {
            "column": 4,
            "row": 10,
            "width": 3,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM NetworkSample\nSELECT average(transmitBytesPerSecond)\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES_PER_SECOND"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average receive errors/s",
          "layout": {
            "column": 7,
            "row": 10,
            "width": 3,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM NetworkSample\nSELECT average(receiveErrorsPerSecond)\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES_PER_SECOND"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average transmit errors/s",
          "layout": {
            "column": 10,
            "row": 10,
            "width": 3,
            "height": 3
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "markers": {
              "displayedTypes": {
                "criticalViolations": false,
                "deployments": true,
                "relatedDeployments": true,
                "warningViolations": false
              }
            },
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "FROM NetworkSample\nSELECT average(transmitErrorsPerSecond)\nWHERE databricksIsDriverNode = 'false'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND entityName IN ({{workerEntityName}})\nFACET databricksClusterName, entityName\nTIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": {
              "isLabelVisible": true
            },
            "units": {
              "unit": "BYTES_PER_SECOND"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        }
      ]
    },
    {
      "name": "Executor Logs",
      "description": null,
      "widgets": [
        {
          "title": "Stdout",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "logger.log-table-widget"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH position(databricksWorkspaceHost, '.') AS firstDot,\n capture(filePath, r'/databricks/spark/work/(?P<appName>[^/]+)/.*') AS appName\nFROM Log\nSELECT substring(databricksWorkspaceHost, 0, firstDot) AS 'Workspace', databricksClusterName AS 'Cluster', hostname AS Hostname, appName AS Application, message AS Message\nWHERE databricksClusterId IS NOT NULL\n AND databricksLogType = 'executor-stdout'\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND hostname IN ({{workerEntityName}})\nLIMIT 1000"
              }
            ]
          }
        },
        {
          "title": "Stderr",
          "layout": {
            "column": 1,
            "row": 5,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "logger.log-table-widget"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH position(databricksWorkspaceHost, '.') AS firstDot,\n capture(filePath, r'/databricks/spark/work/(?P<appName>[^/]+)/.*') AS appName\nFROM Log\nSELECT substring(databricksWorkspaceHost, 0, firstDot) AS 'Workspace', databricksClusterName AS 'Cluster', hostname AS Hostname, appName as Application, level AS Level, message AS Message\nWHERE databricksClusterId IS NOT NULL\n AND databricksLogType = 'executor-stderr'\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND hostname IN ({{workerEntityName}})\nLIMIT 1000"
              }
            ]
          }
        },
        {
          "title": "Infrastrucutre Agent Logs",
          "layout": {
            "column": 1,
            "row": 9,
            "width": 12,
            "height": 4
          },
          "linkedEntityGuids": null,
          "visualization": {
            "id": "logger.log-table-widget"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountIds": [],
                "query": "WITH position(databricksWorkspaceHost, '.') AS firstDot\nFROM Log\nSELECT substring(databricksWorkspaceHost, 0, firstDot) AS 'Workspace', databricksClusterName AS 'Cluster', hostname AS Hostname, MESSAGE.context.component AS Component, MESSAGE.msg AS Message\nWHERE SYSLOG_IDENTIFIER = 'newrelic-infra-service'\n AND databricksClusterId IS NOT NULL\n AND databricksWorkspaceHost IN ({{databricksWorkspaceHost}})\n AND databricksClusterName IN ({{databricksClusterName}})\n AND hostname IN ({{workerEntityName}})\nLIMIT 1000"
              }
            ]
          }
        }
      ]
    }
  ],
  "variables": [
    {
      "name": "databricksWorkspaceHost",
      "items": null,
      "defaultValues": [
        {
          "value": {
            "string": "*"
          }
        }
      ],
      "nrqlQuery": {
        "accountIds": [],
        "query": "SELECT uniques(databricksWorkspaceHost) FROM Log WHERE databricksWorkspaceHost IS NOT NULL"
      },
      "options": {
        "ignoreTimeRange": false,
        "excluded": false
      },
      "title": "Workspace",
      "type": "NRQL",
      "isMultiSelection": true,
      "replacementStrategy": "STRING"
    },
    {
      "name": "databricksClusterName",
      "items": null,
      "defaultValues": [
        {
          "value": {
            "string": "*"
          }
        }
      ],
      "nrqlQuery": {
        "accountIds": [],
        "query": "SELECT uniques(databricksClusterName) FROM Log WHERE databricksClusterName IS NOT NULL"
      },
      "options": {
        "ignoreTimeRange": false,
        "excluded": false
      },
      "title": "Cluster",
      "type": "NRQL",
      "isMultiSelection": true,
      "replacementStrategy": "STRING"
    },
    {
      "name": "driverEntityName",
      "items": null,
      "defaultValues": [
        {
          "value": {
            "string": "*"
          }
        }
      ],
      "nrqlQuery": {
        "accountIds": [],
        "query": "SELECT uniques(entityName) FROM SystemSample WHERE databricksClusterId IS NOT NULL AND databricksIsDriverNode = 'true'"
      },
      "options": {
        "ignoreTimeRange": false,
        "excluded": false
      },
      "title": "Driver Node",
      "type": "NRQL",
      "isMultiSelection": true,
      "replacementStrategy": "STRING"
    },
    {
      "name": "workerEntityName",
      "items": null,
      "defaultValues": [
        {
          "value": {
            "string": "*"
          }
        }
      ],
      "nrqlQuery": {
        "accountIds": [],
        "query": "SELECT uniques(entityName) FROM SystemSample WHERE databricksClusterId IS NOT NULL AND databricksIsDriverNode = 'false'"
      },
      "options": {
        "ignoreTimeRange": false,
        "excluded": false
      },
      "title": "Worker Node",
      "type": "NRQL",
      "isMultiSelection": true,
      "replacementStrategy": "STRING"
    }
  ]
}
