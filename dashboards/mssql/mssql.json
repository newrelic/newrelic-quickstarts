{
    "name": "MSSQL On-Host Integration",
    "description": null,
    "pages": [
      {
        "name": "Overview",
        "description": null,
        "widgets": [
          {
            "title": "Average batch requests per second",
            "layout": {
              "column": 1,
              "row": 1,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(bufferpool.batchRequestsPerSecond) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "Average user connections",
            "layout": {
              "column": 5,
              "row": 1,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(stats.connections) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "SQL compilations per second",
            "layout": {
              "column": 9,
              "row": 1,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(stats.sqlCompilationsPerSecond) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "Buffer cache hit ratio",
            "layout": {
              "column": 1,
              "row": 4,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(system.bufferPoolHitPercent) AS `Buffer Cache Hit Ratio` FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "Lock waits per second",
            "layout": {
              "column": 5,
              "row": 4,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(stats.lockWaitsPerSecond) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "SQL recompilations per second",
            "layout": {
              "column": 9,
              "row": 4,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(stats.sqlRecompilationsPerSecond) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "Page life expectancy in seconds",
            "layout": {
              "column": 1,
              "row": 7,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT (average(bufferpool.pageLifeExpectancyInMilliseconds) / 1000) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "Number of blocked processes",
            "layout": {
              "column": 5,
              "row": 7,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(instance.blockedProcessesCount) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "Total wait time in milliseconds per second",
            "layout": {
              "column": 9,
              "row": 7,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT sum(system.waitTimeInMillisecondsPerSecond) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "Page splits per second",
            "layout": {
              "column": 1,
              "row": 10,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(access.pageSplitsPerSecond) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          },
          {
            "title": "Checkpoint pages per second",
            "layout": {
              "column": 5,
              "row": 10,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(buffer.checkpointPagesPerSecond) FROM MssqlInstanceSample SINCE 1 HOURS AGO FACET entityName TIMESERIES AUTO"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "yAxisLeft": {
                "zero": true
              }
            }
          }
        ]
      },
      {
        "name": "Query Analysis",
        "description": null,
        "widgets": [
          {
            "title": "Database(Unique query count)",
            "layout": {
              "column": 1,
              "row": 1,
              "width": 2,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.bar"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT uniqueCount(QueryID) FROM MSSQLTopSlowQueries WHERE  DatabaseName !='N/A' FACET DatabaseName"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          },
          {
            "title": "Average execution time (ms)",
            "layout": {
              "column": 3,
              "row": 1,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.table"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT \n    average(AvgElapsedTimeMS)\nFROM \n    MSSQLTopSlowQueries\nFACET \n   QueryText"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          },
          {
            "title": "Execution count trends",
            "layout": {
              "column": 7,
              "row": 1,
              "width": 3,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT count(ExecutionCount) from MSSQLTopSlowQueries TIMESERIES \nwhere DatabaseName is not null and DatabaseName != ''"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "thresholds": {
                "isLabelVisible": true
              },
              "yAxisLeft": {
                "zero": true
              },
              "yAxisRight": {
                "zero": true
              }
            }
          },
          {
            "title": "Wait types",
            "layout": {
              "column": 10,
              "row": 1,
              "width": 3,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.bar"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": " SELECT count(total_wait_time_ms) FROM MSSQLWaitTimeAnalysis facet wait_category\n"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          },
          {
            "title": "Top n slowest queries",
            "layout": {
              "column": 1,
              "row": 4,
              "width": 12,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.table"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "initialSorting": {
                "direction": "desc",
                "name": "avg_elapsed_time_ms"
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT \n  latest(QueryText),\n  average(AvgElapsedTimeMS) AS 'Avg Elapsed Time',\n  latest(DatabaseName) ,\n  latest(LastExecutionTimestamp),\n  latest(ExecutionCount),\n  average(AvgCPUTimeMS),\n  average(AvgDiskReads),\n  average(AvgDiskWrites),\n  latest(StatementType),\n  latest(CollectionTimestamp) \nfrom MSSQLTopSlowQueries \nfacet QueryID"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          },
          {
            "title": "Disk I/O usage(Avg disk reads)",
            "layout": {
              "column": 1,
              "row": 7,
              "width": 6,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(AvgDiskReads) as 'Average Disk Reads' From MSSQLTopSlowQueries TIMESERIES \nwhere DatabaseName is not null and DatabaseName != '' FACET DatabaseName"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "thresholds": {
                "isLabelVisible": true
              },
              "yAxisLeft": {
                "zero": true
              },
              "yAxisRight": {
                "zero": true
              }
            }
          },
          {
            "title": "Disk I/O usage(Avg disk writes)",
            "layout": {
              "column": 7,
              "row": 7,
              "width": 6,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.line"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT average(AvgDiskWrites) as 'Average Disk Reads' From MSSQLTopSlowQueries TIMESERIES \nwhere DatabaseName is not null and DatabaseName != '' FACET DatabaseName"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              },
              "thresholds": {
                "isLabelVisible": true
              },
              "yAxisLeft": {
                "zero": true
              },
              "yAxisRight": {
                "zero": true
              }
            }
          },
          {
            "title": "Blocking sessions",
            "layout": {
              "column": 1,
              "row": 10,
              "width": 12,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.table"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "initialSorting": {
                "direction": "desc",
                "name": "Wait Time In Seconds"
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT  latest(BlockedSPID), latest(BlockedStatus), latest(BlockedQueryText), latest(BlockingStatus), latest(WaitTimeInSeconds), latest(DatabaseName) FROM MSSQLBlockingSessionQueries FACET BlockedQueryText "
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          }
        ]
      },
      {
        "name": "Query Details",
        "description": null,
        "widgets": [
          {
            "title": "Individual query details",
            "layout": {
              "column": 1,
              "row": 1,
              "width": 12,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.table"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT latest(SQLText),latest(ExecutionCount),  latest(QueryPlanID)\nFROM MSSQLQueryExecutionPlans\nFACET PlanHandle"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          },
          {
            "title": "Execution plan",
            "layout": {
              "column": 1,
              "row": 4,
              "width": 12,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.table"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT\n latest(QueryID), latest(QueryPlanID),  average(EstimateRows), latest(AvgRowSize), latest(EstimateCPU), latest(EstimateIO), latest(EstimatedExecutionMode), latest(EstimatedOperatorCost), latest(PhysicalOp), latest(GrantedMemoryKb), latest(SpillOccurred), latest(TotalElapsedTime), latest(TotalLogicalReads), latest(TotalLogicalWrites), latest(TotalSubtreeCost), latest(TotalWorkerTime), latest(NoJoinPredicate)\nFROM MSSQLQueryExecutionPlans\nFACET NodeID"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          }
        ]
      },
      {
        "name": "Wait Time Analysis",
        "description": null,
        "widgets": [
          {
            "title": "Wait events",
            "layout": {
              "column": 1,
              "row": 1,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.bar"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT sum(total_wait_time_ms) FROM MSSQLWaitTimeAnalysis Facet wait_category\n"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          },
          {
            "title": "Top wait events",
            "layout": {
              "column": 5,
              "row": 1,
              "width": 8,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.stacked-bar"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "FROM MSSQLWaitTimeAnalysis SELECT latest(avg_wait_time_ms) facet wait_category TIMESERIES LIMIT MAX"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          },
          {
            "title": "Wait event trends",
            "layout": {
              "column": 1,
              "row": 4,
              "width": 8,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.area"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "legend": {
                "enabled": true
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT latest(total_wait_time_ms) FROM MSSQLWaitTimeAnalysis where database_name!='master' FACET database_name TIMESERIES "
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          },
          {
            "title": "Trend of DB instance wait times",
            "layout": {
              "column": 9,
              "row": 4,
              "width": 4,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.bar"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT sum(total_wait_time_ms)/1000 FROM MSSQLWaitTimeAnalysis WHERE  database_name !='N/A' facet database_name"
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          },
          {
            "title": "Top SQL wait times",
            "layout": {
              "column": 1,
              "row": 7,
              "width": 12,
              "height": 3
            },
            "linkedEntityGuids": null,
            "visualization": {
              "id": "viz.table"
            },
            "rawConfiguration": {
              "facet": {
                "showOtherSeries": false
              },
              "initialSorting": {
                "direction": "desc",
                "name": "avg_wait_time_ms"
              },
              "nrqlQueries": [
                {
                  "accountIds": [],
                  "query": "SELECT \n    latest(wait_category) AS wait_category, \n    latest(wait_event_count) AS wait_event_count, \n    latest(avg_wait_time_ms) AS avg_wait_time_ms, \n    latest(total_wait_time_ms) AS total_wait_time_ms,\n    latest(database_name) AS database_name,\n    latest(CollectionTimestamp) AS collection_timestamp\nFROM \n    MSSQLWaitTimeAnalysis\nWHERE \n    wait_category IS NOT NULL\nFACET \n    UPPER(query_text) as query_text\nLIMIT MAX "
                }
              ],
              "platformOptions": {
                "ignoreTimeRange": false
              }
            }
          }
        ]
      }
    ],
    "variables": []
  }